<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diary List</title>
    <style>
        .form {
            margin: 20px 0;
        }
        .input-field {
            margin: 10px 0;
        }
        .input-field input, .input-field textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
        }
        .diary-card {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .diary-card .header-container {
            flex: 1;
        }
        .diary-card .header-left {
            display: flex;
            align-items: center;
        }
        .diary-card .title {
            font-size: 18px;
            font-weight: bold;
            margin-right: 10px;
        }
        .diary-card .date {
            font-size: 14px;
            color: #888;
        }
        .diary-card .content {
            margin-top: 5px;
            white-space: pre-wrap;
        }
        .diary-card .actions {
            flex-shrink: 0;
        }
        .diary-card .actions button {
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <diary-list></diary-list>

    <script>
        const Auth = JSON.parse(localStorage.getItem('currentAuth')) || {
            loggedIn: false,
            userName: null
        };

        // Function to retrieve custom local storage name
        const retrieveStorage = (storageName) => {
            return JSON.parse(localStorage.getItem(storageName)) || {};
        }

        // Function to update data in custom local storage
        const updateStorage = (storageName, data) => {
            localStorage.setItem(storageName, JSON.stringify(data));
        }

        // Function to get diary entries for the current user
        const getDiaryEntries = () => {
            const currentUserData = retrieveStorage(`userData.${Auth.userName}`);
            return currentUserData.diaryEntries || [];
        }

        // Function to save a new diary entry for the current user
        const saveDiaryEntry = (title, date, content) => {
            const timestamp = Date.now();
            const newEntry = {
                id: timestamp,
                title,
                date,
                content
            };

            const currentUserData = retrieveStorage(`userData.${Auth.userName}`);
            const updatedDiaryEntries = [...getDiaryEntries(), newEntry];
            updateStorage(`userData.${Auth.userName}`, { ...currentUserData, diaryEntries: updatedDiaryEntries });

            renderDiaries();
        }

        // Function to render all the diary entries for the current user
        const renderDiaries = () => {
            const diaryContainer = document.getElementById('diary-card-container');
            const emptyListIndicator = document.getElementById('empty-list-indicator');
            diaryContainer.innerHTML = '';

            const diaryEntries = getDiaryEntries();

            if (diaryEntries.length > 0) {
                diaryEntries.forEach(entry => {
                    const diaryCard = document.createElement('div');
                    diaryCard.classList.add('diary-card');

                    diaryCard.innerHTML = `
                        <div class="header-container">
                            <div class="header-left">
                                <div class="title">${entry.title}</div>
                                <div class="date">${entry.date}</div>
                            </div>
                            <div class="diary-card-content">
                                ${entry.content}
                            </div>
                        </div>
                        <div class="actions">
                            <button class="edit-button" onclick="editDiary(${entry.id})">Edit</button>
                            <button class="delete-button" onclick="deleteDiary(${entry.id})">Delete</button>
                        </div>
                    `;

                    diaryContainer.appendChild(diaryCard);
                });
                emptyListIndicator.innerHTML = '';
            } else {
                emptyListIndicator.innerHTML = '<div class="empty-list">There are no diary entries yet.</div>';
            }

            // Add diary card adder button
            const diaryCardAdder = document.createElement('div');
            diaryCardAdder.id = 'diary-card-adder';
            diaryCardAdder.classList.add('diary-card', 'diary-container-item', 'diary-add-button');
            diaryCardAdder.innerHTML = '<div id="add-sign">+</div>';
            diaryCardAdder.addEventListener('click', showDiaryForm);
            diaryContainer.appendChild(diaryCardAdder);
        };

        // Function to show diary form for adding a new entry
        const showDiaryForm = () => {
            const diaryContainer = document.getElementById('diary-card-container');
            diaryContainer.innerHTML = `
                <form id="diary-form" class="form">
                    <div class="input-field">
                        <label for="diary-title">Diary Title</label>
                        <input id="diary-title" type="text" placeholder="Enter diary title" required>
                    </div>
                    <div class="input-field">
                        <label for="diary-date">Date</label>
                        <input id="diary-date" type="date" required>
                    </div>
                    <div class="input-field">
                        <label for="diary-content">Diary Content</label>
                        <textarea id="diary-content" placeholder="Enter diary content" required></textarea>
                    </div>
                    <button type="button" id="save-diary-button">Save Diary</button>
                </form>
            `;

            const saveButton = document.getElementById('save-diary-button');
            saveButton.addEventListener('click', handleSaveDiary);
        };

        // Function to handle saving a new diary entry
        const handleSaveDiary = () => {
            const title = document.getElementById('diary-title').value;
            const date = document.getElementById('diary-date').value;
            const content = document.getElementById('diary-content').value;

            if (!title || !date || !content) {
                alert('All fields are required. Please fill in all the fields.');
                return;
            }

            saveDiaryEntry(title, date, content);

            // Clear the form fields
            document.getElementById('diary-title').value = '';
            document.getElementById('diary-date').value = '';
            document.getElementById('diary-content').value = '';
        };

        // Function to handle editing a diary entry (placeholder)
        const editDiary = (id) => {
            console.log('Editing diary entry with id:', id);
            // Implement editing functionality as needed
        };

        // Function to handle deleting a diary entry (placeholder)
        const deleteDiary = (id) => {
            console.log('Deleting diary entry with id:', id);
            // Implement deletion functionality as needed
        };

        // Custom element definition for the diary list component
        class DiaryList extends HTMLElement {
            connectedCallback() {
                if (!Auth.loggedIn) {
                    window.location.href = '../index.html'; // Redirect to login if not logged in
                    return;
                }

                this.innerHTML = `
                    <div id="navigator-bar">
                        <div class="navigator-item active"><a href="#">Diary list</a></div>
                        <div class="navigator-item"><a href="#">Dashboard</a></div>
                    </div>

                    <div id="main-content">
                        <div id="empty-list-indicator"></div>
                        <div id="diary-card-container"></div>
                    </div>

                    <div id="float-diary-adder" class="diary-add-button">+</div>
                `;

                renderDiaries();
            }
        }

        customElements.define('diary-list', DiaryList);
    </script>
</body>
</html>
